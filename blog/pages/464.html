<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="post-inner-content">
		<header class="entry-header page-header"><h1 class="entry-title ">&#1052;&#1085;&#1086;&#1075;&#1086;&#1087;&#1086;&#1090;&#1086;&#1095;&#1085;&#1086;&#1089;&#1090;&#1100; &#1074; PL/SQL</h1>

			
<!-- .entry-meta -->
		</header><!-- .entry-header --><div class="entry-content">
			<p>&#1042; PL/SQL &#1076;&#1083;&#1103; &#1087;&#1072;&#1088;&#1072;&#1083;&#1083;&#1077;&#1083;&#1100;&#1085;&#1086;&#1081; &#1086;&#1073;&#1088;&#1072;&#1073;&#1086;&#1090;&#1082;&#1080; &#1076;&#1072;&#1085;&#1085;&#1099;&#1093; &#1077;&#1089;&#1090;&#1100; &#1089;&#1083;&#1077;&#1076;&#1091;&#1102;&#1097;&#1080;&#1077; &#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1099;:</p>
<p><strong><span style="color: #008000;">DBMS_SCHEDULER</span></strong> (&#1085;&#1086;&#1074;&#1077;&#1077;)<br><strong><span style="color: #008000;">DBMS_JOB</span></strong> (&#1091;&#1089;&#1090;&#1072;&#1088;&#1077;&#1083;&#1086;)<br><strong><span style="color: #008000;">Parallel Query</span></strong><br><strong><span style="color: #008000;">DBMS_PARALLEL_EXECUTE</span></strong> &#1074; Oracle 11gR2 &#1076;&#1083;&#1103; UPDATE</p>
<p>&#1057; &#1087;&#1086;&#1084;&#1086;&#1097;&#1100;&#1102; DBMS_SCHEDULER &nbsp;&#1084;&#1086;&#1078;&#1085;&#1086; &#1079;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1090;&#1100; &#1087;&#1072;&#1088;&#1072;&#1083;&#1083;&#1077;&#1083;&#1100;&#1085;&#1086; &#1084;&#1085;&#1086;&#1075;&#1086; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088; &#1074; &#1092;&#1086;&#1085;&#1086;&#1074;&#1086;&#1084; &#1088;&#1077;&#1078;&#1080;&#1084;&#1077;. &#1055;&#1088;&#1080;&#1085;&#1094;&#1080;&#1087; &#1088;&#1072;&#1073;&#1086;&#1090;&#1099; &#1087;&#1088;&#1080;&#1084;&#1077;&#1088;&#1085;&#1086;&#1081; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1099;:</p>
<p>1. &#1057;&#1086;&#1079;&#1076;&#1072;&#1102;&#1090;&#1089;&#1103; &#1079;&#1072;&#1076;&#1072;&#1095;&#1080; &#1074; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1086;&#1084; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1077; (nJOBS number := 3)</p>
<p>2. &#1047;&#1072;&#1087;&#1091;&#1089;&#1082;&#1072;&#1102;&#1090;&#1089;&#1103; &#1074;&#1089;&#1077; &#1101;&#1090;&#1080; &#1089;&#1086;&#1079;&#1076;&#1072;&#1085;&#1085;&#1099;&#1077; &#1079;&#1072;&#1076;&#1072;&#1095;&#1080;.</p>
<p>3. &#1056;&#1077;&#1082;&#1091;&#1088;&#1089;&#1080;&#1074;&#1085;&#1086; &#1082;&#1072;&#1078;&#1076;&#1099;&#1077; 5 &#1089;&#1077;&#1082; &#1087;&#1088;&#1086;&#1074;&#1077;&#1088;&#1103;&#1077;&#1090;&#1089;&#1103; &#1089;&#1086;&#1089;&#1090;&#1086;&#1103;&#1085;&#1080;&#1077; &#1101;&#1090;&#1080;&#1093; &#1079;&#1072;&#1076;&#1072;&#1095; &#1076;&#1086; &#1090;&#1077;&#1093; &#1087;&#1086;&#1088; &#1087;&#1086;&#1082;&#1072; &#1085;&#1077; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1072;&#1090;&#1089;&#1103;.</p>
<p>4. &#1055;&#1086;&#1089;&#1083;&#1077; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1077;&#1085;&#1080;&#1103; &#1074;&#1089;&#1077; &#1101;&#1090;&#1080; &#1079;&#1072;&#1076;&#1072;&#1095;&#1080; &#1091;&#1076;&#1072;&#1083;&#1103;&#1102;&#1090;&#1089;&#1103;.</p>
<pre class="lang:plsql">
create or replace procedure P_THREAD_TEST is

nJOBS number := 3;
sJOB_ACTION varchar2(200);

procedure P_JOB_SESSION(sACTION in varchar2) as
nCNT number;
begin
begin
--select 1 into nCNT from v$session v where v.ACTION = sACTION;
SELECT 1 into nCNT FROM USER_SCHEDULER_JOBS WHERE job_name = sACTION AND STATE='RUNNING';
exception
when others then
nCNT := 0;
end;
if (nCNT &gt; 0) then
SYS.DBMS_LOCK.SLEEP(5);
--&#1088;&#1077;&#1082;&#1091;&#1088;&#1089;&#1080;&#1103;
P_JOB_SESSION(sACTION);
end if;
end P_JOB_SESSION;

procedure P_CREATE_JOB as
begin
sJOB_ACTION:='begin
SYS.DBMS_LOCK.SLEEP(30);
end;';
for i in 1 .. nJOBS loop
sys.dbms_scheduler.create_job(job_name =&gt; 'JOB_UPD_' || i,
job_type =&gt; 'PLSQL_BLOCK',
job_action =&gt; sJOB_ACTION);
end loop;
end;

procedure P_RUN_JOB as
begin
for i in 1 .. nJOBS loop
dbms_scheduler.run_job('JOB_UPD_' || i, false);
end loop;
end;

procedure P_DROP_JOB as
begin
for i in 1 .. nJOBS loop
dbms_scheduler.drop_job('JOB_UPD_' || i, TRUE);
end loop;
end;

begin
P_CREATE_JOB;
P_RUN_JOB;
SYS.DBMS_LOCK.SLEEP(5);
for i in 1 .. nJOBS loop
P_JOB_SESSION('JOB_UPD_' || i);
end loop;
P_DROP_JOB;

end P_THREAD_TEST;

</pre>
					</div>
<!-- .entry-content -->

		<!-- .entry-meta --></div></body></html>

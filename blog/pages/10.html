<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="post-inner-content">
		<header class="entry-header page-header"><h1 class="entry-title ">&#1045;&#1097;&#1077; &#1076;&#1074;&#1072; &#1089;&#1087;&#1086;&#1089;&#1086;&#1073;&#1072; &#1079;&#1072;&#1097;&#1080;&#1090;&#1099; &#1086;&#1090; http &#1092;&#1083;&#1091;&#1076;&#1072; (DDOS) fail2ban</h1>


<!-- .entry-meta -->
		</header><!-- .entry-header --><div class="entry-content">
			<p style="text-align: center"><strong>&#1057;&#1087;&#1086;&#1089;&#1086;&#1073; &#8470;1</strong></p>
<p><a href="/uploads/2012/06/linux-logo.png"><img class="alignleft" src="/uploads/2012/06/linux-logo.png" alt="" width="128" height="128"></a>&#1055;&#1088;&#1086;&#1089;&#1084;&#1086;&#1090;&#1088;&#1077;&#1074; &#1083;&#1086;&#1075;&#1080; &#1089;&#1074;&#1086;&#1077;&#1075;&#1086; &#1074;&#1077;&#1073; &#1089;&#1077;&#1088;&#1074;&#1077;&#1088;&#1072; (xampp) /opt/lampp/logs/error_log &#1103; &#1079;&#1072;&#1084;&#1077;&#1090;&#1080;&#1083;, &#1095;&#1090;&#1086; &#1082;&#1090;&#1086;-&#1090;&#1086; &#1073;&#1088;&#1091;&#1090;&#1080;&#1090; &#1087;&#1099;&#1090;&#1072;&#1103;&#1089;&#1100; &#1085;&#1072;&#1081;&#1090;&#1080; &#1095;&#1090;&#1086; &#1090;&#1086;.</p>
<p>[Mon Apr 04 23:05:52 2011] [error] [client XX.104.134.251] File does not exist: /opt/lampp/htdocs/pass.txt, referer: http://webxakep.net<br>
[Mon Apr 04 23:05:52 2011] [error] [client XX.104.134.251] File does not exist: /opt/lampp/htdocs/moderator, referer: http://webxakep.net<br>
[Mon Apr 04 23:05:52 2011] [error] [client XX.104.134.251] File does not exist: /opt/lampp/htdocs/modules, referer: http://webxakep.net<br>
[Mon Apr 04 23:05:52 2011] [error] [client XX.104.134.251] File does not exist: /opt/lampp/htdocs/newsadmin, referer: http://webxakep.net<br>
&#1055;&#1086;&#1089;&#1083;&#1077; &#1091;&#1089;&#1090;&#1072;&#1085;&#1086;&#1074;&#1082;&#1080; fail2ban &#1074; &#1082;&#1086;&#1085;&#1092;&#1080;&#1075;&#1077; /etc/fail2ban/jail.conf &#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1083; &#1101;&#1090;&#1080; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;:</p>
<pre class="lang:bash">
[apache-shorewall]

enabled = true
filter = apache-noscript
action = iptables[name=httpd, port=http, protocol=tcp]
logpath = /opt/lampp/logs/error_log
maxretry = 3

</pre>
<p>true &mdash; &#1074;&#1082;&#1083;&#1102;&#1095;&#1080;&#1090;&#1100;<br>
apache-noscript &mdash; &#1092;&#1080;&#1083;&#1100;&#1090;&#1088; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1083;&#1077;&#1078;&#1080;&#1090; &#1074; /etc/fail2ban/filter.d<br>
iptables[name=httpd, port=http, protocol=tcp] &mdash; &#1092;&#1072;&#1077;&#1088;&#1074;&#1086;&#1083; iptables<br>
/opt/lampp/logs/error_log &mdash; &#1087;&#1091;&#1090;&#1100; &#1082; &#1083;&#1086;&#1075; &#1092;&#1072;&#1081;&#1083;&#1091; &#1072;&#1087;&#1072;&#1095;&#1072;<br>
maxretry = 3 &mdash; &#1082;&#1086;&#1083;-&#1074;&#1086; &#1086;&#1096;&#1080;&#1073;&#1086;&#1082;<br>
&#1055;&#1088;&#1080; &#1074;&#1086;&#1079;&#1085;&#1080;&#1082;&#1085;&#1086;&#1074;&#1077;&#1085;&#1080;&#1077; 3 &#1086;&#1096;&#1080;&#1073;&#1086;&#1082; &#1076;&#1086;&#1089;&#1090;&#1091;&#1087; &#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1091;&#1077;&#1090;&#1089;&#1103; &#1087;&#1088;&#1080; &#1087;&#1086;&#1084;&#1086;&#1097;&#1080; &#1092;&#1072;&#1081;&#1077;&#1088;&#1074;&#1086;&#1083;&#1072; iptables.</p>
<p>&#1058;&#1072;&#1082;&#1078;&#1077; &#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1083; &#1082;&#1086;&#1085;&#1092;&#1080;&#1075; &#1092;&#1080;&#1083;&#1100;&#1090;&#1088;&#1072; &#1074; /etc/fail2ban/filter.d</p>
<pre class="lang:bash">

failregex = [[]client []] (File does not exist|.* not found or unable to stat)

</pre>
<p>&laquo;.*&raquo; &mdash; &#1086;&#1073;&#1086;&#1079;&#1085;&#1072;&#1095;&#1072;&#1077;&#1090; &#1083;&#1102;&#1073;&#1086;&#1081; &#1090;&#1077;&#1082;&#1089;&#1090;<br>
&#1069;&#1090;&#1086; &#1079;&#1085;&#1072;&#1095;&#1080;&#1090; &#1095;&#1090;&#1086; &#1073;&#1091;&#1076;&#1077;&#1090; &#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100;&#1089;&#1103; &#1074;&#1086;&#1090; &#1090;&#1072;&#1082;&#1080;&#1077; &#1089;&#1090;&#1088;&#1086;&#1082;&#1080;:</p>
<p style="text-align: left">[Mon Apr 04 23:04:37 2011] [error] [client XX.104.134.251] script &lsquo;/opt/lampp/htdocs/moderator.php&rsquo; not found or unable to stat, referer: http://webxakep.net<br>
[Mon Apr 04 23:04:27 2011] [error] [client XX.104.134.251] File does not exist: /opt/lampp/htdocs/mssql, referer: http://webxakep.net</p>
<p style="text-align: center"><strong>&#1057;&#1087;&#1086;&#1089;&#1086;&#1073; &#8470;2</strong></p>
<p>&#1042;&#1086; &#1074;&#1088;&#1077;&#1084;&#1103; DDOS &#1074; &#1083;&#1086;&#1075;&#1072;&#1093; &#1072;&#1087;&#1072;&#1095;&#1077; /opt/lampp/logs/access_log &#1079;&#1072;&#1087;&#1080;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103; &#1084;&#1085;&#1086;&#1075;&#1086; &#1090;&#1072;&#1082;&#1080;&#1093; &#1089;&#1090;&#1088;&#1086;&#1082;:</p>
<p>XX.119.73.134 &mdash; &mdash; [23/Jun/2011:14:22:03 +0600] &laquo;GET /index.php HTTP/1.1&raquo; 200 &mdash;<br>
XX.119.73.134 &mdash; &mdash; [23/Jun/2011:14:22:03 +0600] &laquo;GET /index.php HTTP/1.1&raquo; 200 &mdash;<br>
XX.119.73.134 &mdash; &mdash; [23/Jun/2011:14:22:03 +0600] &laquo;GET /index.php HTTP/1.1&raquo; 200 &mdash;<br>
&#1042; /etc/fail2ban/jail.conf &#1080;&#1079;&#1084;&#1077;&#1085;&#1080;&#1083; &#1074;&#1086;&#1090; &#1090;&#1072;&#1082;:</p>
<pre class="lang:bash">

[apache-badbots]

enabled = true
filter = apache-badbots
action = iptables[name=Bad, port=http, protocol=tcp]
logpath = /opt/lampp/logs/access_log
bantime = 1800
maxretry = 250

</pre>
<p>bantime = 1800 &mdash; &#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1072;&#1090;&#1100; &#1085;&#1072; 30 &#1084;&#1080;&#1085;<br>
maxretry = 250 &mdash; &#1082;&#1086;&#1083;&#1080;&#1095;&#1077;&#1089;&#1090;&#1074;&#1086; &#1089;&#1090;&#1088;&#1086;&#1082; &#1074; &#1083;&#1086;&#1075;&#1072;&#1093; &#1089; &#1086;&#1076;&#1085;&#1080;&#1084; &#1080; &#1090;&#1077;&#1084; &#1078;&#1077; IP (&#1084;&#1077;&#1085;&#1100;&#1096;&#1077; &#1089;&#1090;&#1072;&#1074;&#1080;&#1090;&#1100; &#1085;&#1077; &#1089;&#1086;&#1074;&#1077;&#1090;&#1091;&#1102;)</p>
<p>&#1050;&#1086;&#1085;&#1092;&#1080;&#1075; &#1092;&#1080;&#1083;&#1100;&#1090;&#1088;&#1072; &#1074; /etc/fail2ban/filter.d</p>
<pre class="lang:bash">

failregex = ^ -.*"(GET|POST).*

</pre>
<p>&#1059;&#1079;&#1085;&#1072;&#1077;&#1084; &#1082;&#1086;&#1075;&#1086; &#1079;&#1072;&#1073;&#1083;&#1086;&#1082;&#1080;&#1088;&#1086;&#1074;&#1072;&#1083;&#1080; /var/log/fail2ban.log</p>
<p>2011-06-29 04:16:49,743 fail2ban.actions: WARNING [apache-shorewall] Ban XX.24.139.11<br>
2011-06-29 04:16:50,757 fail2ban.actions: WARNING [apache-shorewall] XX.24.139.11 already banned<br>
2011-06-29 04:26:50,211 fail2ban.actions: WARNING [apache-shorewall] Unban XX.24.139.11<br>
2011-06-29 16:55:38,908 fail2ban.actions: WARNING [apache-badbots] Ban XX.119.73.134<br>
PS: &#1103; &#1089;&#1072;&#1084; &#1085;&#1077; &#1076;&#1086;&#1075;&#1086;&#1085;&#1103;&#1102; &#1074;&#1099;&#1088;&#1072;&#1078;&#1077;&#1085;&#1080;&#1077; &laquo;already banned&raquo;</p>
<p>&#1044;&#1086;&#1073;&#1072;&#1074;&#1083;&#1102;, &#1095;&#1090;&#1086; &#1076;&#1083;&#1103; &#1074;&#1082;&#1083;&#1102;&#1095;&#1077;&#1085;&#1080;&#1103;<br>
[ssh-iptables]<br>
&#1085;&#1091;&#1078;&#1085;&#1099; &#1083;&#1086;&#1075;&#1080; /var/log/auth<br>
&#1044;&#1083;&#1103; &#1101;&#1090;&#1086;&#1075;&#1086; &#1085;&#1072;&#1076;&#1086; &#1074;<br>
/etc/syslog.conf<br>
&#1076;&#1086;&#1073;&#1072;&#1074;&#1080;&#1090;&#1100; &#1089;&#1090;&#1088;&#1086;&#1095;&#1082;&#1091;:</p>
<pre class="lang:bash">
auth.* -/var/log/auth

</pre>
<p>&#1087;&#1077;&#1088;&#1077;&#1079;&#1072;&#1087;&#1091;&#1089;&#1090;&#1080;&#1090;&#1100; &#1089;&#1083;&#1091;&#1078;&#1073;&#1091;<br>
service syslog restart<br>
&#1048; &#1077;&#1097;&#1077; &#1085;&#1077; &#1079;&#1072;&#1073;&#1099;&#1074;&#1072;&#1077;&#1084; &#1087;&#1088;&#1072;&#1074;&#1080;&#1083;&#1072;:</p>
<pre class="lang:bash">
iptables -A INPUT -p tcp --syn --dport 80 -m connlimit --connlimit-above 30 -j REJECT
iptables -A INPUT -p tcp --syn --dport 22 -m connlimit --connlimit-above 10 -j REJECT
iptables -A INPUT -p tcp --syn --dport 2106 -m connlimit --connlimit-above 15 -j REJECT
iptables -A INPUT -p tcp --syn --dport 7777 -m connlimit --connlimit-above 200 -j REJECT

</pre>
					</div>
<!-- .entry-content -->

		<!-- .entry-meta --></div></body></html>

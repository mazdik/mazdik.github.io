<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><div class="post-inner-content">
		<header class="entry-header page-header"><h1 class="entry-title ">updater &#1095;&#1077;&#1088;&#1077;&#1079; dblink</h1>

			
<!-- .entry-meta -->
		</header><!-- .entry-header --><div class="entry-content">
			<p>&#1042; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1077; CREATE TABLE R_UDP_TABLE (name VARCHAR2(100), &nbsp;txt CLOB); &#1074; &#1087;&#1086;&#1083;&#1077; clob &#1089;&#1086;&#1076;&#1077;&#1088;&#1078;&#1080;&#1090;&#1089;&#1103; DDL &#1082;&#1086;&#1076;.</p>
<p>&#1042; &#1094;&#1080;&#1082;&#1083;&#1077; &#1087;&#1086; &#1074;&#1089;&#1077;&#1084; &#1083;&#1080;&#1085;&#1082;&#1072;&#1084; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090;&#1089;&#1103; &#1076;&#1080;&#1085;&#1072;&#1084;&#1080;&#1095;&#1077;&#1089;&#1082;&#1080;&#1081; &#1085;&#1077;&#1080;&#1084;&#1077;&#1085;&#1086;&#1074;&#1072;&#1085;&#1085;&#1099;&#1081; &#1073;&#1083;&#1086;&#1082; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1103;&#1077;&#1090; ddl &#1095;&#1077;&#1088;&#1077;&#1079; dblink. &#1042;&#1093;&#1086;&#1076;&#1085;&#1086;&#1081; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; clob &#1080;&#1079; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; &mdash; &#1083;&#1102;&#1073;&#1072;&#1103; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;, &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;, &#1087;&#1072;&#1082;&#1077;&#1090; &#1080; &#1090;.&#1076;.</p>
<p>DBMS_LOB.getlength(cCLOB)/1024 &mdash; &#1091;&#1079;&#1085;&#1072;&#1077;&#1084; &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1074; &#1050;&#1041;.</p>
<p>&#1058;&#1072;&#1082;&#1078;&#1077; &#1084;&#1086;&#1078;&#1085;&#1086; &#1074;&#1099;&#1090;&#1103;&#1085;&#1091;&#1090;&#1100; ddl &#1082;&#1086;&#1076; &#1090;&#1072;&#1082;: SELECT DBMS_METADATA.GET_DDL(&lsquo;PROCEDURE&rsquo;,&rsquo;P_R_TEST&rsquo;,&rsquo;LIDER&rsquo;) from dual;</p>
<pre class="lang:plsql">
create or replace procedure P_R_UPD as
cCLOB clob;
iCNT integer;
sNAME varchar2(100):='P_R_TEST';
begin

/* &#1087;&#1086;&#1083;&#1091;&#1095;&#1080;&#1090;&#1100; &#1082;&#1083;&#1086;&#1073; &#1080;&#1079; &#1090;&#1072;&#1073;&#1083;&#1080;&#1094;&#1099; */
begin
select txt into cCLOB from R_UDP_TABLE where name=sNAME and rownum=1;
exception when NO_DATA_FOUND then
dbms_output.put_line('NO_DATA_FOUND');
end;

if(cCLOB is not null) then

/* &#1088;&#1072;&#1079;&#1084;&#1077;&#1088; &#1082;&#1083;&#1086;&#1073;&#1072; */
DBMS_OUTPUT.put_line('CLOB Size KB ' || round(DBMS_LOB.getlength(cCLOB)/1024, 2));

for cur in(select t.db_link from dba_db_links t where t.DB_LINK not like '%NB%') loop

/* &#1042;&#1099;&#1079;&#1086;&#1074; &#1076;&#1080;&#1085;&#1072;&#1084;&#1080;&#1095;&#1077;&#1089;&#1082;&#1086;&#1075;&#1086; &#1073;&#1083;&#1086;&#1082;&#1072; &#1082;&#1086;&#1090;&#1086;&#1088;&#1099;&#1081; &#1089;&#1086;&#1079;&#1076;&#1072;&#1077;&#1090; ddl &#1095;&#1077;&#1088;&#1077;&#1079; dblink,
&#1074;&#1093;&#1086;&#1076;&#1085;&#1086;&#1081; &#1087;&#1072;&#1088;&#1072;&#1084;&#1077;&#1090;&#1088; clob - &#1083;&#1102;&#1073;&#1072;&#1103; &#1087;&#1088;&#1086;&#1094;&#1077;&#1076;&#1091;&#1088;&#1072;, &#1092;&#1091;&#1085;&#1082;&#1094;&#1080;&#1103;, &#1087;&#1072;&#1082;&#1077;&#1090; &#1080; &#1090;.&#1076; */
execute immediate
'begin
dbms_utility.exec_ddl_statement@'||cur.db_link||'(:cCLOB);
exception when others then
dbms_output.put_line(sqlerrm);
end;'
using cCLOB;

select count(*) into iCNT from V$DBLINK;
if iCNT&gt;0 then
begin
DBMS_SESSION.CLOSE_DATABASE_LINK(cur.db_link);
exception when others then
dbms_output.put_line(iCNT);
end;
iCNT:=0;
end if;

end loop;

begin
DBMS_SESSION.FREE_UNUSED_USER_MEMORY;
end;

end if;

end P_R_UPD;
/

</pre>
					</div>
<!-- .entry-content -->

		<!-- .entry-meta --></div></body></html>
